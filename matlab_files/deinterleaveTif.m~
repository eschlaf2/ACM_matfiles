function [] = deinterleaveTif(filename,tot_chan)


[path,name,ext] = fileparts(which(filename));
filename = [path filesep name ext];

i=0;
while ~isempty(dir(sprintf('tmp%d*',i)))
    i=i+1;
end
pfx = sprintf('tmp%d',i);

N = length(imfinfo(filename));
assert(N<17576,'File has too many frames (max is 17576).')

file_inds = '';
for chan = 1:tot_chan
    j = 0;
    for dummy_i = chan:tot_chan:N
        j = j+1;
        o1 = char(96+mod(j,676));
        o2 = char(96+mod(j,26));
        o3 = char(96+j);
        file_inds = sprintf('%s, %s%s%s,',file_inds,o1,o2,o3);
    end

file_inds = file_inds(3:end-1);
if j > 1
    file_inds = ['{' file_inds '}'];
end

setenv('path',path);
setenv('cpfiles',file_inds);
setenv('filename',filename);
setenv('pfx',pfx);
setenv('tfcp',[pfx file_inds '.tif']);
setenv('outname',[name '_ch' num2str(chan) '.tif']);
!tiffcp $tfcp $outname
!rm -rf $pfx*.tif